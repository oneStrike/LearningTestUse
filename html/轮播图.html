<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../css/reset.min.css">
    <link rel="stylesheet" href="../css/轮播图.css">
    <script src="../jQuery/node_modules/jquery/dist/jquery.js"></script>
</head>

<body>
    <section class="container" id="container">
        <div class="wrapper">
            <!-- <div class="slide"><img src="../images/1.png" alt=""></div>
        <div class="slide"><img src="../images/2.png" alt=""></div>
        <div class="slide"><img src="../images/3.png" alt=""></div>
        <div class="slide"><img src="../images/4.png" alt=""></div> -->
        </div>
        <ul class="focus">
            <!-- <li class="active"></li> -->
            <!-- <li></li>
        <li></li>
        <li></li> -->
        </ul>
        <a href="javascript:;" class="arrow arrowLeft"></a>
        <a href="javascript:;" class="arrow arrowRight"></a>
    </section>
    <!--    <script src="../js/animate.js"></script>-->
    <script src="../jQuery/jquery1.11.3/dist/jquery.js"></script>
    <!-- <script src="../js/轮播图.js"></script> -->
    <script>
        $(function () {
            let $container = $('#container'),
                $wrapper = $container.find('.wrapper'),
                $focus = $container.find('.focus'),
                $arrowLeft = $container.find('.arrowLeft'),
                $arrowRight = $container.find('.arrowRight'),
                $imgList = null,
                $focusList = null,
                index = 0,
                lastIndex = 0,
                autoTimer = null,
                speed = 300,
                interval = 1000;
            //获取数据
            let queryData = function () {
                return new Promise(function (resolve, reject) {
                    $.ajax({
                        url: '../json/banner.json',
                        method: 'get',
                        dataType: 'json',
                        async: true,
                        success: resolve,
                        error: reject
                    });
                })
            };

            //绑定数据
            let bindHTML = function (data) {
                let $data = $(data),
                    imgStr = ``,
                    focusStr = ``;
                $data.each(function (index, item) {
                    imgStr += `<div class="slide"><img src="${item.img}" alt=""></div>`;
                    focusStr += `<li class="${index===0?"active":""}"></li>`;
                });
                $wrapper.append(imgStr);
                $focus.append(focusStr);
                $imgList = $wrapper.find('.slide');
                $focusList = $focus.find('li');
                $imgList.eq(0).clone().appendTo($wrapper);
                $imgList = $wrapper.find('.slide');
                $wrapper.width($imgList.length * parseFloat($imgList.eq(0).width()));
            };

            //设置动画
            let autoMove = function () {
                index++;
                if (index >= $imgList.length) {
                    index = 1;
                    $wrapper.css('left', '0px');
                };
                $wrapper.animate({
                    left: -index * $imgList.eq(0).outerWidth()
                }, speed);
                setFocus();
            };

            //设置焦点
            let setFocus = function () {
                let $index = index;
                $index === $focusList.length ? $index = 0 : null;
                $focusList.eq($index).addClass("active");
                $focusList.eq(lastIndex).removeClass("active");
                lastIndex = $index;
            };

            //鼠标划入划出
            let setMouse = function () {
                $container.hover(function () {
                    $arrowLeft.add($arrowRight).css('display', 'block');
                    clearInterval(autoTimer);
                }, function () {
                    $arrowLeft.add($arrowRight).css('display', 'none');
                    autoTimer = setInterval(function () {
                        autoMove();
                    }, interval)
                })
            }

            //焦点点击
            let focusClick = function () {
                $focusList.each(function (i, item) {
                    $(item).on('click', function () {
                        $wrapper.animate({
                            left: -$(item).index() * $imgList.eq(0).width()
                        }, speed);
                        index = $(item).index();
                        setFocus();
                    })
                });
            };

            //侧边点击
            let slidClick = function () {
                $arrowRight.on('click', autoMove);
                $arrowLeft.on('click', function () {
                    index--;
                    if (index < 0) {
                        index = $imgList.length - 2;
                        $wrapper.css('left', -$imgList.length - 1 * $imgList.eq(0).width())
                    };
                    $wrapper.animate({
                        left: -index * $imgList.eq(0).width()
                    }, speed);
                    setFocus();
                })
            };

            let promise = queryData();
            promise.then(function (data) {
                bindHTML(data);
            }).then(function () {
                autoTimer = setInterval(function () {
                    autoMove();
                }, interval);
                setMouse();
                focusClick();
                slidClick();
            })
        });
    </script>
</body>

</html>